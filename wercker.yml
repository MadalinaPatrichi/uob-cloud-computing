box: openjdk:8

build:
  steps:
    - script:
      name: gradle test
      cwd: app
      code: |
        ./gradlew test
    - script:
      name: gradle build
      cwd: app
      code: |
        ./gradlew build
    - script:
      name: clean
      code: |
        rm -rf app/.gradle
    - internal/docker-build:
      cwd: app
      dockerfile: Dockerfile.multi_stage
      image-name: uobcloudcomputing/todoapp

deploy-docker:
  steps:
    - internal/docker-push:
      username: $DOCKER_USERNAME
      password: $DOCKER_PASSWORD
      tag: latest
      repository: uobcloudcomputing/todoapp
    
deploy-jar:
  steps:
    - script:
      name: deploy jar
      cwd: app
      code: ./release.sh
      
deploy-docs:
  steps:
    - script:
      name: build and deploy docs
      cwd: app
      code: echo noop
