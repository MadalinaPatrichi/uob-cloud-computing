box: openjdk:8

build:
  steps:
    - script:
      name: gradle test
      cwd: app
      code: |
        ./gradlew test
    - script:
      name: gradle build
      cwd: app
      code: |
        ./gradlew build
    - internal/docker-build:
      cwd: app
      dockerfile: Dockerfile.multi_stage
      image-name: uobcloudcomputing/todoapp

deploy-docker:
  steps:
    - internal/docker-push:
      username: $DOCKER_USERNAME
      password: $DOCKER_PASSWORD
      tag: latest
      registry: https://hub.docker.com
      repo: uobcloudcomputing/todoapp
    
deploy-jar:
  steps:
    - script:
      name: deploy jar
      cwd: app
      code: echo noop
      
deploy-docs:
  steps:
    - script:
      name: build and deploy docs
      cwd: app
      code: echo noop
